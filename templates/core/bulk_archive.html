{% extends 'base.html' %}
{% load eztables %}

{% block css %}
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}theme/global/plugins/select2/select2.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}theme/global/plugins/data-tables/DT_bootstrap.css">
{% endblock %}

{% block js %}
    <script type="text/javascript" src="{{ STATIC_URL }}theme/global/plugins/select2/select2.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}theme/global/plugins/data-tables/jquery.dataTables.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}theme/global/plugins/data-tables/DT_bootstrap.js"></script>
    <script type="text/javascript"
            src="{{ STATIC_URL }}theme/global/plugins/data-tables/tabletools/js/dataTables.tableTools.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/bootstrap-datepicker.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/all_table.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
        });

        $("#archive").click(function(){
            const selectedValues = $('input.custom-control-input:checked').map( function () {

                const element = $(this).parent().parent().parent().parent()
                const requestType = element.data("type");
                return {
                    id: element.data('id'),
                    type: requestType === "custom request" ? "custom": requestType === "corporate request" ? "corporate" : "individual"
                }
                })
                .get()
            $.ajax({
                url: '/archive_bulk_requests/',
                type: 'POST',
                data:JSON.stringify({requests: selectedValues}),
                success: function(data) {
                    window.location.reload();
                    }
                });
        })


    </script>

{% endblock %}

{% block sidebar %}
    {% if supervisor %}
        {% include 'core/_supervisor_sidebar.html' %}
    {% else %}
        {% include 'core/_employee_sidebar.html' %}
    {% endif %}
{% endblock %}

{% block content %}

    <div class="page-content">
        <h3 style="padding-top:10px;" class="page-title">Select request to archive in bulk </h3>
        <div>
            <button id="archive" class="btn btn-primary">
                Archive
            </button>
        </div>
        <br>
        
        <div class="clearfix">
        </div>
        
                <div class="row">
                  <div class="col-lg-12">
                    <table class="table table-bordered">
                      <thead>
                        <tr>
                          <th ></th>
                          <th >ID</th>
                          <th >Name</th>
                          <th >Date Completed</th>
                          <th >Report</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for status in statuses %}
                        <tr>
                            <td data-id="{{status.content_object.pk}}" data-type="{{status.content_type}}">
                              <div class="custom-control custom-checkbox">
                                  <input type="checkbox" class="custom-control-input">
                                  <!-- <label class="custom-control-label" for="customCheck2">2</label> -->
                              </div>
                            </td>
                            <td>{{ status.content_object.display_id }}</td>
                            <td>{{ status.content_object.name }} {{status.content_object.company_name}} {{status.content_object.first_name }} {{status.content_object.last_name}}</td>
                            <td>{{ status.datetime }}</td>
                            <td>
                                <a target="_blank\" download="{{status.content_object.report_url}}" >{{status.content_object.report_url}}</a>
                                </td>
                          </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                
        </div>
    </div>
{% endblock %}